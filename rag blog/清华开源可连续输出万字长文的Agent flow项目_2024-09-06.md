嘿，大家好！这里是一个专注于AI智能体的频道！

今天休息一下，看一下清华和智谱AI联合发布的这个新研究，如何通过Agent让LLM写出长达万词的长文！这可比写一篇毕业论文还要长呢！

> **LongWriter: Unleashing 10,000+ Word Generation from Long Context LLMs**

> 当前的长上下文大型语言模型 （LLM） 可以处理多达 100,000 个标记的输入，但难以生成超过 2,000 个单词的适度长度的输出。通过对照实验，我们发现模型的有效生成长度本质上受其在监督微调 （SFT） 期间看到的样本的限制。换言之，它们的输出限制是由于现有 SFT 数据集中长输出样本的稀缺性。为了解决这个问题，**我们引入了 AgentWrite，这是一种基于Agent的管道，可将超长生成任务分解为子任务，使现成的 LLM 能够生成超过 20,000 字的连贯输出**。利用 AgentWrite，我们构建了 LongWriter-6k，这是一个包含 6,000 个 SFT 数据的数据集，输出长度从 2k 到 32k 字不等。通过将此数据集整合到模型训练中，我们成功地将现有模型的输出长度扩展到超过 10,000 个单词，同时保持输出质量。我们还开发了LongBench-Write，这是一个用于评估超长生成能力的综合基准。我们的 9B 参数模型通过 DPO 进一步改进，在此基准上实现了最先进的性能，甚至超过了更大的专有模型。总的来说，我们的工作表明，现有的长上下文 LLM 已经具备了更大的输出窗口的潜力——您所需要的只是在模型对齐期间具有扩展输出的数据来解锁此功能。


简单来说，现在的LLM虽然能处理超长的文字输入，但要它们自己写出个几千词的文章，那可就难了。为啥呢？研究者们发现，这是因为在训练过程中，模型见到的输出样本太短了！

那咋办？于是大神们整出了一个叫AgentWrite的玩意儿，这是个能分解任务的智能体。简单来说，就是把一篇长文拆成一小段一小段的，然后让模型一段一段地写，最后再拼起来。这样，即使是现成的LLM也能写出超长的文章来。

![](https://files.mdnice.com/user/50285/68384544-13de-4dd8-befd-a48a8bd1009f.png)

AgentWrite分两步走：先是“Plan”阶段，模型会根据指令，规划出文章的结构和每段的大概词数；然后是“write”阶段，模型根据这个计划，一段接一段地写，而且写的时候还会记得前面写了啥，保证文章的连贯性。

“plan”阶段的prompt如下：
```
我需要你帮我将以下长篇写作指令分解为多个子任务。每个子任务将指导文章中一个段落的写作，并应包括该段落的主要观点和字数要求。
写作指令如下：
{用户指令}
请按照以下格式进行分解，每个子任务占一行：
第一段 - 主要观点：[详细描述段落的主要观点] - 字数：
[字数要求，例如，400字]
第二段 - 主要观点：[详细描述段落的主要观点] - 字数：
[字数要求，例如，1000字]。
...
确保每个子任务都清晰具体，并且所有子任务覆盖了写作指令的全部内容。不要将子任务拆分得太细；每个子任务的段落不应少于200字且不超过1000字。不要输出任何其他内容。
```
“write”阶段的prompt如下：
```
你是一位出色的写作助手。我将给你一个原始的写作指令和我计划的写作步骤。我还会提供我已经写好的文本。请帮我根据写作指令、写作步骤以及已经写好的文本继续写下一个段落。
写作指令：
{用户指令}
写作步骤：
{第一步生成的写作计划}
已经写好的文本：
{之前生成的(n-1)个段落}
请整合原始写作指令、写作步骤以及已经写好的文本，现在继续写{第n段的计划，即写作计划中的第n行}给我。如果需要，你可以在开头添加一个小标题。记得只输出你写的段落，不要重复已经写好的文本。
```

除了这个AgentWrite流程还不够，因为模型的长文写作能力还不够，于是还做了一个LongWriter-6k的数据集，里面有6000个训练样本，用于提升模型的长文写作能力（这些数据的输出长度从2,000到32,000个词不等。通过将这个数据集纳入模型训练，成功地将现有模型的输出长度扩展到超过10,000个词，同时保持了输出质量）。

为了严格评估方法的有效性，又开发了一个叫LongBench-Write的测试标准，专门用来评估模型写长文的能力。

![](https://files.mdnice.com/user/50285/867e113f-9abe-4b4d-b11a-a2731c8e9423.png)


- 开源仓库：https://github.com/THUDM/LongWriter
- 论文地址：https://arxiv.org/pdf/2408.07055

好了，这就是我今天想分享的内容。如果你对构建AI智能体感兴趣，别忘了点赞、关注噢~